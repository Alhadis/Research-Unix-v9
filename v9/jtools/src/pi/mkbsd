OFILES=bsdsymtab.o gram.o batch.o wd.o kerncore.o kernmaster.o kernproc.o hostcore.o master.o hostmaster.o asm.o audit.o bpts.o core.o dtype.o expr.o format.o frame.o lib.o main.o memory.o parse.o phrase.o process.o srctext.o symbol.o symtab.o sigmask.o srcdir.o hostproc.o journal.o m68kasm.o waitlist.o vtbl.o dummy.o m68kcore.o rt.o rtraw.o rtnrtx.o

PRIFILES=dtype.pri asm.pri bpts.pri core.pri format.pri expr.pri frame.pri master.pri memory.pri phrase.pri process.pri srctext.pri symtab.pri journal.pri
HFILES=asm.h bpts.h core.h dtype.h ed8.h expr.h format.h frame.h gram.h hostcore.h lib.h master.h memory.h mip.h op.h parse.h phrase.h process.h sigmask.h srcdir.h srctext.h symbol.h symtab.h univ.h y.tab.h journal.h m68kcore.h
PUBFILES=dtype.pub asm.pub bpts.pub core.pub expr.pub format.pub frame.pub master.pub memory.pub phrase.pub process.pub srctext.pub symtab.pub journal.pub

INC=-I../pads
CLEAVE=cleave
LIB=/usr/jtools/src/pads/host/libpads.a /usr/dak/rt5/host/dbio.o
NPROC=1
cppC=/usr/lib/cpp
CWD=/usr/jtools/src/pi
cfrontC=/usr/shopiro/C++/SFcfront/cfront
BUILTINS="
%.o:	%.c
	CC $INC -c -g +e0 $CWD/$stem.c
%.o:	%.s
	as -o $stem.o $stem.s"

pi:	$PRIFILES $PUBFILES $HFILES $OFILES
	rm -f pi rtpi
	cc -o pi -g $OFILES $LIB
	ln pi rtpi

install: pi
	rm -f /usr/jtools/s3bin/rtpi /usr/jtools/s3bin/pi \
	/usr/jtools/x3bin/rtpi /usr/jtools/x3bin/pi
	ln pi /usr/jtools/s3bin/rtpi
	ln pi /usr/jtools/s3bin/pi
	ln pi /usr/jtools/x3bin/pi
	ln pi /usr/jtools/x3bin/rtpi
	rm -f pi rtpi

rinstall:
	rcp /usr/X11/bin/pi shamash:/usr/dak/x11
	rcp /usr/X11/bin/pi cinnamon:/usr/dak/bin

%.pri:	%.h
	$CLEAVE  $INC  $CFLAGS $stem
	touch $stem.pri

vtbl.o:	vtbl.c
	CC $INC -c -g +e1  vtbl.c

cmcio.o: old/cmcio.o
	cp old/cmcio.o .

gram.c:	gram.y
	yacc -d gram.y
	mv y.tab.c gram..c
	sed -f gram.sed gram..c > gram.c
	rm gram..c

clean:
	rm -f *junk* core jim.* *.o pi

diffsrc:
	/usr/tac/bin/diffsrc /n/seki/usr/tac/pi/host /usr/jerq/src/pi/host
asm.o: asm.pri
asm.o: core.pub
asm.o: format.pub
asm.o: parse.h
asm.o: expr.pub
asm.o: frame.pub
asm.o: process.pub
asm.o: symtab.pub
asm.o: symbol.h
asm.o: bpts.pub
asm.h: univ.h
	touch asm.h
audit.o: univ.h
batch.o: master.pri
batch.o: process.pri
batch.o: frame.pub
batch.o: hostcore.h
batch.o: format.pub
batch.o: expr.pub
batch.o: symbol.h
bpts.o: univ.h
bpts.o: core.pub
bpts.o: bpts.pri
bpts.o: symbol.h
bpts.o: expr.pub
bpts.o: format.pub
bpts.o: process.pub
bpts.o: symtab.pub
bpts.o: parse.h
bpts.h: univ.h
	touch bpts.h
core.o: process.pub
core.o: frame.pri
core.o: symtab.pri
core.o: symbol.h
core.o: core.pri
core.o: master.pub
core.h: univ.h
	touch core.h
dtype.o: dtype.pri
dtype.o: symbol.h
dtype.o: format.pub
dtype.o: mip.h
dtype.o: phrase.pub
dtype.o: expr.pub
dtype.h: univ.h
	touch dtype.h
ed8symtab.o: symtab.pri
ed8symtab.o: dtype.pri
ed8symtab.o: symbol.h
expr.o: expr.pri
expr.o: gram.h
expr.o: symbol.h
expr.o: format.pub
expr.o: frame.pri
expr.o: phrase.pub
expr.o: symtab.pub
expr.o: core.pub
expr.h: univ.h
	touch expr.h
expr.h: dtype.pub
expr.h: op.h
expr.h: format.pub
format.o: univ.h
format.o: format.pri
format.o: symtab.pub
format.o: symbol.h
format.h: univ.h
	touch format.h
frame.o: frame.pri
frame.o: core.pub
frame.o: symbol.h
frame.o: symtab.pub
frame.o: format.pub
frame.o: expr.pub
frame.o: phrase.pri
frame.o: parse.h
frame.o: process.pub
frame.o: bpts.pub
frame.o: journal.pub
frame.h: univ.h
	touch frame.h
gram.o: gram.h
gram.o: expr.pub
gram.o: bpts.pub
hostcore.o: process.pub
hostcore.o: frame.pri
hostcore.o: symtab.pri
hostcore.o: symbol.h
hostcore.o: hostcore.h
hostcore.o: asm.pri
hostcore.o: format.pub
hostcore.o: bpts.pri
hostcore.o: master.pri
hostcore.h: core.pri
	touch hostcore.h
hostmaster.o: hostcore.h
hostmaster.o: master.pri
hostmaster.o: process.pri
hostmaster.o: symtab.pri
hostproc.o: univ.h
hostproc.o: process.pri
hostproc.o: sigmask.h
hostproc.o: hostcore.h
hostproc.o: expr.pub
hostproc.o: master.pub
hostproc.o: bpts.pri
hostproc.o: frame.pri
hostproc.o: memory.pub
hostproc.o: symtab.pub
hostproc.o: symbol.h
hostproc.o: srcdir.h
hostproc.o: asm.pub
journal.o: journal.pri
journal.o: core.pub
journal.o: format.h
journal.h: univ.h
	touch journal.h
kerncore.o: process.pri
kerncore.o: frame.pri
kerncore.o: symtab.pri
kerncore.o: symbol.h
kerncore.o: hostcore.h
kerncore.o: master.pri
kernmaster.o: hostcore.h
kernmaster.o: master.pri
kernmaster.o: process.pri
kernmaster.o: symtab.pri
kernproc.o: univ.h
kernproc.o: process.pri
kernproc.o: hostcore.h
kernproc.o: master.pub
kernproc.o: frame.pri
kernproc.o: memory.pub
kernproc.o: symtab.pub
kernproc.o: symbol.h
kernproc.o: srcdir.h
kernproc.o: asm.pub
kernproc.o: parse.h
kernproc.o: expr.pub
lib.o: lib.h
m68kasm.o: asm.pri
m68kasm.o: m68kasm.h
m68kasm.o: format.pub
m68kasm.o: core.pub
m68kcore.o: process.pub frame.pri symtab.pri symbol.h m68kcore.h \
	asm.pri format.pub bpts.pri master.pri
main.o: master.pri
main.o: format.pri
master.o: master.pri
master.o: process.pri
master.h: univ.h
	touch master.h
mcc.h: univ.h
	touch mcc.h
mccsymtab.o: mcc.h
mccsymtab.o: symtab.pri
mccsymtab.o: dtype.pri
mccsymtab.o: symbol.h
memory.o: core.pub
memory.o: symtab.pub
memory.o: memory.pri
memory.o: parse.h
memory.o: expr.pub
memory.o: frame.pub
memory.o: process.pub
memory.o: format.pub
memory.o: journal.pub
memory.h: univ.h
	touch memory.h
parse.o: parse.h
parse.h: gram.h
	touch parse.h
parse.h: y.tab.h
parse.h: expr.pub
phrase.o: expr.pri
phrase.o: phrase.pri
phrase.o: frame.pub
phrase.o: parse.h
phrase.o: format.pub
phrase.o: symtab.pub
phrase.o: symbol.h
phrase.o: core.pub
phrase.o: process.pub
phrase.h: univ.h
	touch phrase.h
process.o: hostcore.h
process.o: process.pri
process.o: srcdir.h
process.o: expr.pub
process.o: master.pub
process.o: bpts.pri
process.o: frame.pri
process.o: memory.pub
process.o: asm.pub
process.o: symtab.pub
process.o: symbol.h
process.o: srctext.pub
process.o: format.pub
process.o: journal.pub
process.h: univ.h
	touch process.h
process.h: format.h
sigmask.o: hostcore.h
sigmask.o: process.pri
sigmask.o: srctext.pub
sigmask.o: sigmask.h
sigmask.h: univ.h
	touch sigmask.h
srcdir.o: srcdir.h
srcdir.o: process.pri
srcdir.o: symbol.h
srcdir.o: srctext.pri
srcdir.o: symtab.pub
srcdir.h: univ.h
	touch srcdir.h
srctext.o: symbol.h
srctext.o: srctext.pri
srctext.o: core.pub
srctext.o: symtab.pub
srctext.o: process.pub
srctext.o: bpts.pub
srctext.o: expr.pub
srctext.o: format.pub
srctext.o: frame.pri
srctext.h: univ.h
	touch srctext.h
symbol.o: univ.h
symbol.o: dtype.pri
symbol.o: symbol.h
symbol.o: symtab.pub
symbol.o: srctext.pub
symbol.o: core.pub
symbol.o: process.pub
symbol.o: bpts.pub
symbol.o: phrase.pub
symbol.o: parse.h
symbol.o: format.pub
symbol.h: univ.h
	touch symbol.h
symbol.h: dtype.pub
symtab.o: symtab.pri
symtab.o: dtype.pri
symtab.o: symbol.h
symtab.o: srctext.pub
symtab.o: phrase.pub
symtab.o: format.pub
symtab.o: core.pub
symtab.h: univ.h
	touch symtab.h
symtab.h: mip.h
univ.h: lib.h
	touch univ.h
vtbl.o: process.pub
vtbl.o: frame.pub
vtbl.o: symtab.pub
vtbl.o: symbol.h
vtbl.o: hostcore.h
vtbl.o: asm.pub
vtbl.o: format.pub
vtbl.o: bpts.pri
vtbl.o: master.pub
vtbl.o: process.pub
vtbl.o: expr.pub
vtbl.o: bpts.pub
vtbl.o: master.pub
vtbl.o: ed8.h
vtbl.o: mcc.h
vtbl.o: asm.pri
vtbl.o: m68kasm.h
waitlist.o: process.pub
waitlist.o: frame.pri
waitlist.o: symtab.pri
waitlist.o: symbol.h
waitlist.o: hostcore.h
waitlist.o: asm.pri
waitlist.o: format.pub
waitlist.o: bpts.pri
waitlist.o: master.pri
wd.o: univ.h
asm.pub: univ.h
	touch asm.pub
bpts.pub: univ.h
	touch bpts.pub
core.pub: univ.h
	touch core.pub
dtype.pub: univ.h
	touch dtype.pub
expr.pub: univ.h
	touch expr.pub
expr.pub: dtype.pub
expr.pub: op.h
expr.pub: format.pub
format.pub: univ.h
	touch format.pub
frame.pub: univ.h
	touch frame.pub
journal.pub: univ.h
	touch journal.pub
master.pub: univ.h
	touch master.pub
memory.pub: univ.h
	touch memory.pub
phrase.pub: univ.h
	touch phrase.pub
process.pub: univ.h
	touch process.pub
process.pub: format.h
srctext.pub: univ.h
	touch srctext.pub
symtab.pub: univ.h
	touch symtab.pub
symtab.pub: mip.h
asm.pri: univ.h
bpts.pri: univ.h
core.pri: univ.h
dtype.pri: univ.h
expr.pri: univ.h
expr.pri: dtype.pub
expr.pri: op.h
expr.pri: format.pub
format.pri: univ.h
frame.pri: univ.h
journal.pri: univ.h
master.pri: univ.h
memory.pri: univ.h
phrase.pri: univ.h
process.pri: univ.h
process.pri: format.h
srctext.pri: univ.h
symtab.pri: univ.h
symtab.pri: mip.h
